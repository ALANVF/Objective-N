#import "../objn/main.neko"
#import "../objn/object.neko"
#import "../objn/ON.mn"

#import "../tests/mal/mal_readline.mn"

function READ(str) {objn_Typecheck(ON_String,str,false)
	return str
}

function EVAL(ast, env) {objn_Typecheck(ON_String,ast,false);objn_Typecheck(ON_String,env,false)
	return ast
}

function PRINT(exp) {objn_Typecheck(ON_String,exp,false)
	return exp
}

function REP(line) {objn_Typecheck(ON_String,line,false)
	return PRINT(EVAL(READ(line), @""));
}

function main() {
	while true {
		var rawline = _readline("user> ")
		if rawline == null {break}
		var line = @(rawline)
		if [line length] == 0 {continue}
		$print(REP(line), "\n")
	}
}

main()