//#import "types.hn"
#import "../tests/mal/malfunc.hn"

@implementation MalFunc
	- init:(ON_Array)ast env:(Env)env params:(ON_Array)params {
		this->ast = objn_Copy(ast)
		this->env = objn_Copy(env)
		this->params = objn_Copy(params)
		this->isMacro = false
		this->meta = null
		return this
	}
	
	- apply:(ON_Array)args {
		return EVAL(this->ast, [Env fromBindings:this->env
		                                   binds:this->params
		                                   exprs:args])
	}
@end

function apply(f, args) {objn_Typecheck($array($tfunction,MalFunc),f,false);objn_Typecheck(ON_Array,args,false);
	if objn_Typecheck(MalFunc,f,true)
		return [f apply:args]
	else
		return f(args)
}