#import "../objn/main.neko"
#import "../objn/object.neko"
#import "../objn/ON.mn"

#import "../tests/mal/mal_readline.mn"
#import "../tests/mal/types.mn"
#import "../tests/mal/reader.mn"
#import "../tests/mal/printer.mn"

function READ(str) {objn_Typecheck(ON_String,str,false)
	return read_str(str)
}

function EVAL(ast, env) {objn_Typecheck(ON_Object,ast,false);objn_Typecheck(ON_String,env,false)
	return ast
}

function PRINT(exp) {objn_Typecheck(ON_Object,exp,false)
	return _pr_str(exp, true)
}

function REP(line) {objn_Typecheck(ON_String,line,false)
	return PRINT(EVAL(READ(line), @""))
}

function main() {
	while true {
		var rawline = _readline("user> ")
		if rawline == null {break}
		var line = @(rawline)
		if [line length] == 0 {continue}
		$print(REP(line), "\n")
	}
}

main()